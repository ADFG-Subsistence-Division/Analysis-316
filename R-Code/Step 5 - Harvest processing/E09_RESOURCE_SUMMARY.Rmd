---
title: "E09_RESOURCE_SUMMARY - (316) NPS Ambler Comprehensive"
author: "Jesse Coleman"
date: "2025-08-15"
output:
  html_document:
    theme: null
    css: ../HTML/adfg-style.css
    include:
      before_body: ../HTML/header.html
      after_body: ../HTML/footer.html
---
<div class="title-container">
  <img class="title-logo" src="../HTML/adfg_logo.png" alt="ADFG Logo"/>
  <div class="title">E09_RESOURCE_SUMMARY - (316) NPS Ambler Comprehensive</div>
</div>

# Resource Summary

Produce outputs that list the resources asked about as well as scientific names for those resources and conversion factors used.

## Change log

### Change 1
- Programmer: D.S.Koster  
- Date: 04/22/2024  
- Change Description: Updated organization and formatting to be more consistent and provide better feedback/output. Corrected a few issues with outputs.  
- Template Update [Y|N]: Y  
- One-Off: No-include in all future comprehensive templates  

### Change 2
- Programmer: Jesse Coleman
- Date: 03/18/2025
- Change Description: Removed source() calls; all functions are included in the library adfgSubs.
- Template Update [Y|N]: Y
- One-Off: No-include in all future comprehensive templates 

## Input data
  
- /CSV/03 - Main/convFact.csv  
- /CSV/05 - Final Analysis Output/harvest_use_raw.csv  
- /CSV/00 - Lookup Codes/fullResList_raw.csv  
- /CSV/00 - Lookup Codes/fullScientificResourceList.csv  
- /CSV/00 - Lookup Codes/fullCodesetList.csv  
- /CSV/00 - Lookup Codes/fullCommuntyList.csv

## Output data
  
- /CSV/05 - Final Analysis Output/resource_conversions_raw.csv  
- /CSV/05 - Final Analysis Output/resources_summary_raw.csv  

## Background

## Checklist
  
- Update 'Author' to your name  
- Update the project information in 'title' to the current project  
- Update the development log with any changes you've made to the template file, including your name  
- Update the table template  
- Compare results presented here to those in the template 

## Additional information

### Required libraries (adjust as needed)
  
- tidyverse   
- rio   
- knitr  
- kableExtra
- adfgSubs

```{r setup, echo=FALSE}

# Set some knit options and functions for formatting data.
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(include = TRUE)
knitr::opts_chunk$set(results='asis')

options(knitr.kable.NA = '')

```

# Data processing

## Initialize environment

```{r initalize environment}

# Clear out all existing variables & datasets.
rm(list=ls(all=TRUE))

# Additional libraries
library(knitr)
library(kableExtra)
library(adfgSubs)

# Include the project parameters file - this needs to be updated for all 
#   projects.
source('../Z00_PROJECT_PARAMETERS.r')
# source('../Functions/f_RMD_HTML_FORMATTING_FUNCTIONS.r')

# Note project information
cat(str_interp('<p class="rbn">Working on project ${projID} ${projectName} - ${studyear}</p>'))

```

## Load data

```{r load data}

# ##############################################################################
# Load data from intermediate files.
# ##############################################################################


convData <- read.csv('../../CSV/03 - Main/convFact.csv', 
                      na = '', 
                      header = TRUE, 
                      strip.white = TRUE)
count <- nrow(convData)
cat(formatSummaryBlock(paste("Opening file: convFact.csv, ", 
                             count, 
                             " records loaded.", sep="")))

harvData <- read.csv('../../CSV/05 - Final Analysis Output/harvest_use_raw.csv', 
                     na = '', 
                     header = TRUE, 
                     strip.white = TRUE) %>%
  filter(specList == 1) %>%
  select(projID, studyear, communty, commname, resource)
count <- nrow(harvData)
cat(formatSummaryBlock(paste("Opening file: harvest_use_raw.csv, ", 
                             count, 
                             " records loaded (Filered to primary species only).", sep="")))

resNameData <- read.csv('../../CSV/00 - Lookup Codes/fullResList_raw.csv', 
                        na = '', 
                        header = TRUE, 
                        strip.white = TRUE)
count <- nrow(resNameData)
cat(formatSummaryBlock(paste("Opening file: fullResList_raw.csv, ", 
                             count, 
                             " records loaded.", sep="")))

sciResNameData <- read.csv('../../CSV/00 - Lookup Codes/fullScientificResourceList.csv', 
                       na = '', 
                       header = TRUE, 
                       strip.white = TRUE)
count <- nrow(sciResNameData)
cat(formatSummaryBlock(paste("Opening file: fullScientificResourceList.csv, ", 
                             count, 
                             " records loaded.", sep="")))

unitLabelData <- read.csv('../../CSV/00 - Lookup Codes/fullCodesetList.csv', 
                          na = '', 
                          header = TRUE, 
                          strip.white = TRUE) %>%
                 filter(codeSetID == 5) %>%
                 rename("units" = "code",
                        "unitDescription" = "codeDescription") %>%
                 select(units, unitDescription)
count <- nrow(unitLabelData)
cat(formatSummaryBlock(paste("Opening file: fullCodesetList.csv, ", 
                             count, 
                             " records loaded (Unit codes ONLY).", sep="")))

commNameData <- read.csv('../../CSV/00 - Lookup Codes/fullCommuntyList.csv', 
                         na = '', 
                         header = TRUE, 
                         strip.white = TRUE)
count <- nrow(commNameData)
cat(formatSummaryBlock(paste("Opening file: fullCommuntyList.csv, ", 
                             count, 
                             " records loaded .", sep="")))

# Remove any white-space present in the resName field.
resNameData$resName = trimws(resNameData$resName, which=c("both"))

commnameList <- select(harvData, commname) %>% distinct(commname)

```

# Orgainze files for output.

```{r display summary}

# conversion factors.

convOutputData <- select(convData, projID, studyear, communty, resource, units, convFact) %>%
  left_join(unitLabelData, by=c("units")) %>%
  left_join(commNameData, by=c("communty")) %>%
  left_join(sciResNameData, by=c("resource")) %>%
  select(projID, studyear, communty, commname, resource, properResName,
         units, unitDescription, convFact)

# 3.0 Resources used/listed

useOutputData <- left_join(harvData, sciResNameData, by=c("resource"))

```

```{r output table review}

tmpConvData <- select(convOutputData, commname, properResName, unitDescription, convFact)
tmpUsedData <- select(useOutputData, commname, properResName, scientificName)

for(comm in commnameList$commname) 
{
  tmpConvTblData <- filter(tmpConvData, commname == comm) %>%
    select(-commname)

    tblOut <- kbl(tmpConvTblData,
                col.names = c('Resource name',	'Reported units',	'Conversion factor'),
    caption=formatTableHeader(str_interp("Conversion factors, ${comm}, ${studyear}"))) %>%
    kable_styling(full_width = F)
  
    print(tblOut)  
  
  tmpUsedTblData <- filter(tmpUsedData, commname == comm) %>%
    select(-commname)
  
    tblOut <- kbl(tmpUsedTblData,
                col.names = c('Resource', 'Scientific name'),
    caption=formatTableHeader(str_interp("Resources listed on ${comm} survey, ${studyear}"))) %>%
    kable_styling(full_width = F)  
    print(tblOut)  

}
  
```



# Write CSV files

```{r write csv files}

# ##############################################################################
# Write out CSV files.
# ##############################################################################

# Write out the resource conversion file
  fName = '../../CSV/05 - Final Analysis Output/resource_conversions_raw.csv'
  cat(formatSummaryBlock(
    paste('Writing file: ', fName, 
          ' ', nrow(convOutputData), ' records to be written', sep='')))

# For 2023; we are, by default, working exclusively with R code..
  rio::export(convOutputData, fName)

# Write out the resource summary file.
  fName = '../../CSV/05 - Final Analysis Output/resources_summary_raw.csv'
  cat(formatSummaryBlock(
    paste('Writing file: ', fName, 
          ' ', nrow(useOutputData), ' records to be written', sep='')))

# For 2023; we are, by default, working exclusively with R code..
  rio::export(useOutputData, fName)
  
```

<p class="h1footer"> End of resource summary script. </p>
